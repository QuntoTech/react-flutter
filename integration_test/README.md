# React-Flutteræµ‹è¯•æ–‡æ¡£

æœ¬ç›®å½•åŒ…å«äº†React-Flutteræ¡†æ¶çš„å®Œæ•´æµ‹è¯•ä½“ç³»ï¼Œä¸“æ³¨äºéªŒè¯React-Flutter-Agentæ¶æ„çš„ç«¯åˆ°ç«¯åŠŸèƒ½ã€‚

## ğŸ“ æµ‹è¯•ç»“æ„

```
integration_test/                     # â­ React-Flutteré›†æˆæµ‹è¯•ç›®å½•
â”œâ”€â”€ agent_integration_test.dart       # Counter Agentå®Œæ•´åŠŸèƒ½é›†æˆæµ‹è¯•
â””â”€â”€ README.md                         # æœ¬æ–‡æ¡£
```

## ğŸ¯ æ ¸å¿ƒæµ‹è¯•ï¼šCounter Agenté›†æˆæµ‹è¯•

### ğŸš€ æ›¿ä»£æ‰‹åŠ¨éªŒè¯
**ä¹‹å‰**: æ¯æ¬¡ä¿®æ”¹ â†’ `flutter run` â†’ æ‰‹åŠ¨ç‚¹å‡»æµ‹è¯•  
**ç°åœ¨**: è¿è¡Œ `flutter test integration_test -d windows` â†’ è‡ªåŠ¨éªŒè¯å®Œæ•´åŠŸèƒ½é“¾è·¯

### ğŸ“‹ æµ‹è¯•è¦†ç›–èŒƒå›´

#### 1. **Agentåˆå§‹åŒ–å’ŒåŠ è½½æµ‹è¯•**
- âœ… ReactEngineåˆå§‹åŒ–
- âœ… Counter AgentæˆåŠŸåŠ è½½
- âœ… åŸºç¡€UIå…ƒç´ æ¸²æŸ“
- âœ… åˆå§‹çŠ¶æ€æ­£ç¡®æ€§ (è®¡æ•°: 0)
- âœ… æŒ‰é’®å’Œæ–‡æœ¬å…ƒç´ å­˜åœ¨

#### 2. **æ ·å¼ç³»ç»Ÿæ¸²æŸ“æµ‹è¯•**
- âœ… **EdgeInsets**: padding/margin å„ç§ç»„åˆ
- âœ… **Color**: é¢œè‰²å€¼å’Œé€æ˜åº¦
- âœ… **BorderRadius**: circularã€onlyã€symmetric
- âœ… **Border**: allã€onlyã€symmetricè¾¹æ¡†
- âœ… **å¤æ‚æ ·å¼ç»„åˆ**: decoration + padding + margin

#### 3. **CounteråŸºç¡€äº¤äº’æµ‹è¯•**
- âœ… +1æŒ‰é’®ç‚¹å‡»å“åº”
- âœ… -1æŒ‰é’®ç‚¹å‡»å“åº”
- âœ… çŠ¶æ€æ›´æ–°åŒæ­¥éªŒè¯
- âœ… è¿ç»­æ“ä½œæ­£ç¡®æ€§

#### 4. **æ•°æ®åŒæ­¥å‹åŠ›æµ‹è¯•**
- âœ… å¿«é€Ÿè¿ç»­ç‚¹å‡»5æ¬¡+1
- âœ… å¿«é€Ÿè¿ç»­ç‚¹å‡»3æ¬¡-1
- âœ… React stateä¸Flutter UIå®æ—¶åŒæ­¥
- âœ… é«˜é¢‘æ“ä½œç¨³å®šæ€§

#### 5. **UIçŠ¶æ€æŒä¹…æ€§æµ‹è¯•**
- âœ… çŠ¶æ€ä¿æŒéªŒè¯
- âœ… æŒ‰é’®æŒç»­å¯ç”¨æ€§
- âœ… UIå…ƒç´ å®Œæ•´æ€§
- âœ… åŠŸèƒ½æŒç»­æ€§éªŒè¯

## ğŸš€ è¿è¡Œæµ‹è¯•

### ğŸ”¥ è¿è¡Œå®Œæ•´é›†æˆæµ‹è¯• (æ¨è)

```bash
# è¿è¡Œå®Œæ•´çš„Counter Agenté›†æˆæµ‹è¯•
flutter test integration_test -d windows

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
flutter test integration_test/agent_integration_test.dart -d windows

# å¸¦è¯¦ç»†è¾“å‡º
flutter test integration_test -d windows --verbose
```

### ğŸ› ï¸ ç¯å¢ƒè¦æ±‚

**é‡è¦**: é›†æˆæµ‹è¯•éœ€è¦ç‰¹æ®Šçš„ç¯å¢ƒè®¾ç½®æ¥æ”¯æŒflutter_jsï¼š

```bash
# 1. å…ˆæ„å»ºWindowsåº”ç”¨
flutter build windows

# 2. è®¾ç½®PATHç¯å¢ƒå˜é‡ (æ¯æ¬¡æ–°çš„PowerShellä¼šè¯éƒ½éœ€è¦)
$env:path += ";${pwd}\build\windows\x64\runner\Release"

# 3. ç„¶åè¿è¡Œé›†æˆæµ‹è¯•
flutter test integration_test -d windows
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Šç¤ºä¾‹

è¿è¡Œé›†æˆæµ‹è¯•åï¼Œæ‚¨å°†çœ‹åˆ°ï¼š

```
ğŸš€ æµ‹è¯•Agentåˆå§‹åŒ–å’ŒåŠ è½½...
ğŸ“± å¯åŠ¨React-Flutteråº”ç”¨...
ğŸš€ Initializing Counter Agent...
âœ… Agent metadata registered to globalThis.CounterAgent
ğŸ‰ Counter Agent initialization complete
â³ ç­‰å¾…Counter AgentåŠ è½½...
âœ… Found widget after 10ms: Found 1 widget with key [<'counter_agent_ready'>]
âœ… Counter Agentå°±ç»ªï¼
âœ… Agentåˆå§‹åŒ–å’ŒåŠ è½½æµ‹è¯•é€šè¿‡

ğŸ¨ æµ‹è¯•æ ·å¼ç³»ç»Ÿæ¸²æŸ“...
ğŸ“Š æ‰¾åˆ°5ä¸ªContainerç»„ä»¶
  âœ… Container 1 Padding: EdgeInsets(32.0, 24.0, 32.0, 24.0)
  âœ… Container 1 Margin: EdgeInsets.all(16.0)
  âœ… Container 1 BorderRadius: BorderRadius.circular(12.0)
  âœ… Container 1 Border: Border.all(BorderSide(color: Color(...), width: 2.0))
  ... (æ›´å¤šæ ·å¼è¯¦æƒ…)
âœ… æ ·å¼ç³»ç»Ÿæ¸²æŸ“æµ‹è¯•é€šè¿‡ - å‘ç°13ä¸ªæ ·å¼åŒ–å±æ€§

ğŸ”¢ æµ‹è¯•CounteråŸºç¡€äº¤äº’...
âœ… CounteråŸºç¡€äº¤äº’æµ‹è¯•é€šè¿‡

âš¡ æµ‹è¯•æ•°æ®åŒæ­¥å‹åŠ›...
ğŸ”„ å¿«é€Ÿå¢åŠ æµ‹è¯•...
ğŸ”„ å¿«é€Ÿå‡å°‘æµ‹è¯•...
âœ… æ•°æ®åŒæ­¥å‹åŠ›æµ‹è¯•é€šè¿‡

ğŸ æµ‹è¯•UIçŠ¶æ€æŒä¹…æ€§...
âœ… UIçŠ¶æ€æŒä¹…æ€§æµ‹è¯•é€šè¿‡

æ€»è®¡: 5ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ ğŸ‰
æ€»è€—æ—¶: ~25ç§’
```

## ğŸ¯ æµ‹è¯•æ¶æ„ä¼˜åŠ¿

### âš¡ æ€§èƒ½ä¼˜åŒ–
- **ç²¾ç¡®ç­‰å¾…**: ä½¿ç”¨çŠ¶æ€æ£€æµ‹è€Œä¸æ˜¯å›ºå®šæ—¶é—´ç­‰å¾…
- **æ¯«ç§’çº§å“åº”**: Agentå°±ç»ªæ£€æµ‹å¹³å‡10ms
- **æ™ºèƒ½åˆå§‹åŒ–**: åªåœ¨å¿…è¦æ—¶ç­‰å¾…ï¼Œé¿å…æµªè´¹æ—¶é—´

### ğŸ” å®Œæ•´è¦†ç›–
- **ç«¯åˆ°ç«¯éªŒè¯**: ä»Reactä»£ç åˆ°Flutteræ¸²æŸ“çš„å®Œæ•´é“¾è·¯
- **çœŸå®ç¯å¢ƒ**: åœ¨å®é™…Windowsåº”ç”¨ä¸­è¿è¡Œæµ‹è¯•
- **æ ·å¼ç³»ç»Ÿ**: éªŒè¯æ‰€æœ‰APIåŒ–æ ·å¼ç±»(Color, EdgeInsets, BorderRadius, Border)

### ğŸ›¡ï¸ å¯é æ€§ä¿è¯
- **ç‹¬ç«‹æµ‹è¯•**: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç‹¬ç«‹è¿è¡Œï¼Œå¤±è´¥éš”ç¦»
- **çŠ¶æ€éªŒè¯**: åŸºäºæ˜ç¡®çš„UIçŠ¶æ€è€Œéæ—¶é—´çŒœæµ‹
- **å‹åŠ›æµ‹è¯•**: éªŒè¯å¿«é€Ÿæ“ä½œä¸‹çš„ç³»ç»Ÿç¨³å®šæ€§

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. **ç²¾ç¡®çŠ¶æ€æ£€æµ‹**
```dart
// ç­‰å¾…Counter Agentå°±ç»ªçš„æ˜ç¡®ä¿¡å·
await pumpUntilFound(tester, find.byKey(const Key('counter_agent_ready')));
```

### 2. **çœŸå®åº”ç”¨å¯åŠ¨**
```dart
// ä½¿ç”¨çœŸå®çš„main()å‡½æ•°å¯åŠ¨åº”ç”¨
app.main();
await tester.pumpAndSettle();
```

### 3. **æ™ºèƒ½ç­‰å¾…æœºåˆ¶**
```dart
// è‡ªå®šä¹‰ç­‰å¾…å‡½æ•°ï¼Œé¿å…å›ºå®šæ—¶é—´ç­‰å¾…
Future<void> pumpUntilFound(WidgetTester tester, Finder finder, {Duration timeout})
```

## ğŸš€ è§£å†³çš„æ ¸å¿ƒæŒ‘æˆ˜

### ğŸ”¥ Flutter+React+JSæ··åˆç¼–ç¨‹æµ‹è¯•éš¾é¢˜
- âœ… è§£å†³äº†flutter_jsåœ¨æµ‹è¯•ç¯å¢ƒä¸­çš„DLLåŠ è½½é—®é¢˜
- âœ… è§£å†³äº†Timer pendingå¼‚å¸¸é—®é¢˜
- âœ… å®ç°äº†ReactEngineåœ¨é›†æˆæµ‹è¯•ä¸­çš„ç¨³å®šè¿è¡Œ

### âš¡ æµ‹è¯•æ€§èƒ½ä¼˜åŒ–
- âœ… ä»å›ºå®š30ç§’ç­‰å¾…ä¼˜åŒ–åˆ°å¹³å‡10msç²¾ç¡®æ£€æµ‹
- âœ… ä»å•ä¸ªæµ‹è¯•2åˆ†é’Ÿä¼˜åŒ–åˆ°å®Œæ•´æµ‹è¯•å¥—ä»¶25ç§’
- âœ… å®ç°äº†çœŸæ­£çš„"ç­‰å¾…çŠ¶æ€è€Œä¸æ˜¯æ—¶é—´"

### ğŸ¯ æ¶æ„éªŒè¯å®Œæ•´æ€§
- âœ… éªŒè¯React-sideæ ·å¼API (Color.blue, EdgeInsets.allç­‰)
- âœ… éªŒè¯Flutter-sideæ¸²æŸ“æ­£ç¡®æ€§
- âœ… éªŒè¯è·¨å¹³å°æ•°æ®è½¬æ¢å‡†ç¡®æ€§

## ğŸ”® æœªæ¥æ‰©å±•

å½“æ‚¨æ·»åŠ æ–°çš„Agentæˆ–åŠŸèƒ½æ—¶ï¼Œå¯ä»¥å‚è€ƒç°æœ‰æµ‹è¯•ç»“æ„ï¼š

```dart
testWidgets('æ–°åŠŸèƒ½æµ‹è¯•', (WidgetTester tester) async {
  await launchAppAndWaitReady(tester);
  
  // éªŒè¯æ–°åŠŸèƒ½
  expect(find.text('æ–°åŠŸèƒ½'), findsOneWidget);
  
  // äº¤äº’æµ‹è¯•
  await tester.tap(find.text('æ–°æŒ‰é’®'));
  await tester.pumpAndSettle();
  
  // çŠ¶æ€éªŒè¯
  expect(find.text('é¢„æœŸç»“æœ'), findsOneWidget);
});
```

---

ğŸ‰ **è¿™ä¸ªæµ‹è¯•ç³»ç»Ÿæ ‡å¿—ç€React-Flutter-Agentæ¶æ„çš„å®Œå…¨æˆç†Ÿï¼**  
ç°åœ¨æ‚¨å¯ä»¥å®‰å¿ƒå¼€å‘å¤æ‚çš„æ··åˆç¼–ç¨‹åº”ç”¨ï¼Œç¡®ä¿æ¯ä¸ªåŠŸèƒ½éƒ½ç»è¿‡å®Œæ•´éªŒè¯ï¼ğŸš€